---
layout: post
title: "git"
date: 2019-09-03
description: "基础git操作"
tag: [git]
comments: true
---

## git 安装
```
git config --global user.name "name"
git config --global user.email "email@example.com"
```
## git init
```
git init
git add XXX.txt YYY.txt
git add ZZZ.txt
git commit -m <message>
```

## 版本控制
### git status
```
$ git status
On branch master
Your branch is ahead of 'origin/master' by 1 commit.
  (use "git push" to publish your local commits)

Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

        modified:   nine/src/main/java/com/iahsnil/nine/service/impl/SpiderServi                                                                                                                                                                                               ceImpl.java

Untracked files:
  (use "git add <file>..." to include in what will be committed)

        config-client/configclient.iml
        config-client/target/
        config/target/
        nine/src/main/resources/pyscript/cuq.txt
        nine/src/main/resources/pyscript/cyt.txt
        nine/src/main/resources/pyscript/hhy.txt

no changes added to commit (use "git add" and/or "git commit -a")
```
**git status** 命令可以让我们时刻掌握仓库当前的状态
### git diff
```
$ git diff nine/src/main/java/com/iahsnil/nine/service/impl/SpiderServiceImpl.java
diff --git a/nine/src/main/java/com/iahsnil/nine/service/impl/SpiderServiceImpl.java b/nine/src/main/java/com/iahsnil/nine/service/impl/SpiderServiceImpl.java
index 3a738ad..669dff7 100644
--- a/nine/src/main/java/com/iahsnil/nine/service/impl/SpiderServiceImpl.java
+++ b/nine/src/main/java/com/iahsnil/nine/service/impl/SpiderServiceImpl.java
@@ -62,7 +62,7 @@ public class SpiderServiceImpl implements SpiderService {

     @Override
     @Async
-    @Scheduled(cron = "* 0/5 * * * *")
+    @Scheduled(cron = "* * 11/5 * * *")
     public Future<String> refreshList() {
         StringBuilder sb = new StringBuilder();
```
**git diff** 顾名思义就是查看difference，显示的格式正是Unix通用的diff格式

## 版本回退
### git log 提交历史
```
commit ddc483c266fd9d48adfe2821d95bfe67f3ea6e40 (HEAD -> master)
Author: DESKTOP-3M8EM7B\zed <iahsnil1994@gmail.com>
Date:   Thu Aug 22 21:01:24 2019 +0700

    定时执行爬取数据代码

commit 5b9d62a9994415303822055466432355d2a69317 (origin/master, origin/HEAD)
Author: DESKTOP-3M8EM7B\zed <iahsnil1994@gmail.com>
Date:   Wed Aug 21 21:08:45 2019 +0700

    spring security permission

commit 7ec28a1664c67615af9fb055f586dbed2639c960
Author: DESKTOP-3M8EM7B\zed <iahsnil1994@gmail.com>
Date:   Tue Aug 20 21:05:22 2019 +0700

    登录/注册

commit 05b960e2463ac67c84ac8b50e6856360c2993b86
Author: DESKTOP-3M8EM7B\zed <iahsnil1994@gmail.com>
Date:   Mon Aug 19 21:14:13 2019 +0700

    添加分页

commit f27384ca0078b15d9a3043bb76929178af4ea857
Author: DESKTOP-3M8EM7B\zed <iahsnil1994@gmail.com>
Date:   Sat Aug 17 21:01:10 2019 +0700

    vedio player
```
### git reflog 命令历史
```
git reflog
ddc483c (HEAD -> master) HEAD@{0}: commit: 定时执行爬取数据代码
5b9d62a (origin/master, origin/HEAD) HEAD@{1}: commit: spring security permission
7ec28a1 HEAD@{2}: commit: 登录/注册
05b960e HEAD@{3}: commit: 添加分页
f27384c HEAD@{4}: commit: vedio player
9fa5715 HEAD@{5}: commit: 加入gateway，调整pom.xml
ce25661 HEAD@{6}: commit: 调整结构
5e80e01 HEAD@{7}: commit: quartz 任务调度框架
8d0e67d HEAD@{8}: commit: zuul second commit
51fe1da HEAD@{9}: commit: zuul first commit
62e3aa6 HEAD@{10}: commit: websocket
14056a1 HEAD@{11}: commit: delete some records
f942efa HEAD@{12}: commit: movie database
93011d3 HEAD@{13}: commit: request limit
d0b07e9 HEAD@{14}: commit: redis distributed lock
644cdc7 HEAD@{15}: commit: xiaozhuan font generator
b742d24 HEAD@{16}: commit: ok http util
05421c5 HEAD@{17}: commit: mail sender
d112af5 HEAD@{18}: commit: commit 2019-04-25
b15f2f3 HEAD@{19}: merge origin/master: Fast-forward
6e8c023 HEAD@{20}: commit: 91porn spider done
6ba5271 HEAD@{21}: commit: create a rudiment
aa4258f HEAD@{22}: merge origin/master: Fast-forward
6f175c6 HEAD@{23}: commit: second commit
47e0efc HEAD@{24}: commit: first commit
0f088ba HEAD@{25}: clone: from https://github.com/lindage1994/yasuo.git
```
### git reset --hard commit_id 回退或前进到某个版本

```
$ git reset --hard 7ec28a1
HEAD is now at 7ec28a1 登录/注册
```
--mixed
意思是：不删除工作空间改动代码，撤销commit，并且撤销git add . 操作
这个为默认参数,git reset --mixed HEAD^ 和 git reset HEAD^ 效果是一样的。

--soft  
不删除工作空间改动代码，撤销commit，不撤销git add .

--hard
删除工作空间改动代码，撤销commit，撤销git add .

注意完成这个操作后，就恢复到了上一次的commit状态。

- HEAD指向的版本就是当前版本，因此，Git允许我们在版本的历史之间穿梭，使用命令git reset --hard commit_id。

- 穿梭前，用git log可以查看提交历史，以便确定要回退到哪个版本。

- 要重返未来，用git reflog查看命令历史，以便确定要回到未来的哪个版本。

## 工作区和暂存区
git add 操作是将文件修改添加到暂存区
git commit 操作是将暂存区文件提交到当前分支

git checkout -- file 撤销修改到最近一次git commit 或git add 时的状态
如果文件修改后未放到暂存区，撤销修改就回到和版本库一样的状态
如果文件提交到暂存区后又作了修改，撤销修改就会回到暂存区后的状态
(use "git reset HEAD <file>..." to unstage)
使用git reset HEAD <file> 取消提交到暂存区
git checkout -- file命令中的--很重要，没有--，就变成了“切换到另一个分支”的命令

##  删除文件
git rm <file>
如果误删 git checkout -- <file> 撤销
 注意：从来没有被添加到版本库就被删除的文件，是无法恢复的！
 命令git rm用于删除一个文件。如果一个文件已经被提交到版本库，那么你永远不用担心误删，但是要小心，你只能恢复文件到最新版本，你会丢失最近一次提交后你修改的内容。

## 远程仓库



## 分支管理
### 查看分支
git branch
### 创建分支
git branch dev
### 切换分支
git checkout dev
git checkout -b dev ==  git branch dev + git checkout device
### 合并指定分支到当前分支
git merge dev
### 删除分支
git branch -d dev

### switch
切换分支命令git checkout branch <branch> 和撤销修改命令git checkout -- <file>是同一个命令，有点令人迷惑
所以新版本的git提供了新的git switch命令来切换分支
创建并切换分支
git switch -c dev
切换到已有分支
git switch master

### 解决冲突
当Git无法自动合并分支时，就必须首先解决冲突。解决冲突后，再提交，合并完成。
解决冲突就是把Git合并失败的文件手动编辑为我们希望的内容，再提交。
用git log --graph命令可以看到分支合并图。

### bug分支
#### 保存工作现场
git stash
#### 查看保存的工作现场
git stash list
#### 恢复工作现场
git stash apply  恢复后stash内容不删除，需要用git stash drop来删除
git stash pop 恢复的同时删除stash内容
#### 合并指定提交
git cherry-pick <commit>

### feature
开发一个新feature，最好新建一个分支；
如果要丢弃一个没有被合并过的分支，可以通过git branch -D <name>强行删除。

### 远程分支
查看远程库信息，使用git remote -v；
本地新建的分支如果不推送到远程，对其他人就是不可见的；
从本地推送分支，使用git push origin branch-name，如果推送失败，先用git pull抓取远程的新提交；
在本地创建和远程分支对应的分支，使用git checkout -b branch-name origin/branch-name，本地和远程分支的名称最好一致；
建立本地分支和远程分支的关联，使用git branch --set-upstream branch-name origin/branch-name；
从远程抓取分支，使用git pull，如果有冲突，要先处理冲突。

### rebase(变基)
rebase操作可以把本地未push的分叉提交历史整理成直线；
rebase的目的是使得我们在查看历史提交的变化时更容易，因为分叉的提交需要三方对比。


## 标签管理
### 创建标签
命令git tag <tagname>用于新建一个标签，默认为HEAD，也可以指定一个commit id；
命令git tag -a <tagname> -m "blablabla..."可以指定标签信息；
命令git tag可以查看所有标签。

### 管理标签
命令git push origin <tagname>可以推送一个本地标签；
命令git push origin --tags可以推送全部未推送过的本地标签；
命令git tag -d <tagname>可以删除一个本地标签；
命令git push origin :refs/tags/<tagname>可以删除一个远程标签。
